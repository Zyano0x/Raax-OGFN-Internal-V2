#include "exploits.h"

#include <cheat/cache/pickupcache.h>
#include <cheat/core.h>
#include <drawing/drawing.h>
#include <config/config.h>

namespace Features {
namespace Exploits {

void TickGameThread() {
    const auto&                 Config = Config::g_Config.Exploit;
    SDK::AFortPlayerPawnAthena* LocalPawn = SDK::Cast<SDK::AFortPlayerPawnAthena>(SDK::GetLocalPawn());
    if (!LocalPawn)
        return;

    SDK::AFortWeapon* Weapon = LocalPawn->CurrentWeapon();
    if (Weapon) {
        if (Config.RapidFire) {
            float a = Weapon->LastFireTime();
            float b = Weapon->LastFireTimeVerified();
            Weapon->Set_LastFireTime(a + b - 0.3f);
        }

        if (Config.NoSpread) {
            Weapon->Set_CustomTimeDilation(99);
        } else {
            Weapon->Set_CustomTimeDilation(1);
        }

        SDK::UFortWeaponItemDefinition* WeaponData = Weapon->WeaponData();
        if (Config.AutomaticWeapons && WeaponData) {
            WeaponData->SetTriggerType(SDK::EFortWeaponTriggerType::Automatic);
        }
    }

    if (Config.InstantRevive) {
        LocalPawn->Set_ReviveFromDBNOTime(1.f);
    }
}

} // namespace Exploits
} // namespace Features
