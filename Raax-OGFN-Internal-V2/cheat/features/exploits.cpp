#include "exploits.h"

#include <cheat/cache/pickupcache.h>
#include <cheat/core.h>
#include <drawing/drawing.h>
#include <config/config.h>

namespace Features {
namespace Exploits {

void TickGameThread() {
    const auto&                 Config = Config::g_Config.Exploit;
    auto* const LocalPawn = SDK::Cast<SDK::AFortPlayerPawnAthena>(SDK::GetLocalPawn());
    if (!LocalPawn)
        return;

    SDK::AFortWeapon* Weapon = LocalPawn->CurrentWeapon;
    if (Weapon) {
        if (Config.RapidFire) {
            Weapon->LastFireTime = 0;
        }

        // Not working
        //if (Config.NoSpread) {
        //    Weapon->CustomTimeDilation = 99;
        //} else {
        //    Weapon->CustomTimeDilation = 1;
        //}

        SDK::UFortWeaponItemDefinition* WeaponData = Weapon->WeaponData;
        if (Config.AutomaticWeapons && WeaponData) {
            WeaponData->TriggerType = SDK::EFortWeaponTriggerType::Automatic;
        }
    }

    if (Config.InstantRevive) {
        LocalPawn->ReviveFromDBNOTime = 1.f;
    }
}

} // namespace Exploits
} // namespace Features
